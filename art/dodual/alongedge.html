<!doctype html>
<html>
<head>
<style></style>
<script src='spork.js'></script>
<script>
var p,s3;
var v=[],m=[],f=[],d=[];
var R=300;
var edges=[
	[0,3], [3,6,], [6,9], [9,12], [12,0],
	[4,2], [2,15], [15,18], [18,21], [21,4],
	[5,23], [23,24], [24,27], [27,7], [7,5],
	[8,29], [29,41], [41,42], [42,10], [10,8],
	[38,59], [59,46], [46,43], [43,40], [40,38],
	[11,44], [44,45], [45,48], [48,13], [13,11],
	[1,14], [14,50], [50,51], [51,16], [16,1],
	[17,53], [53,54], [54,31], [31,19], [19,17],
	[20,30], [30,33], [33,25], [25,22], [22,20],
	[26,35], [35,36], [36,39], [39,28], [28,26],
	[32,56], [56,57], [57,37], [37,34], [34,32],
	[47,58], [58,55], [55,52], [52,49], [49,47],
	]
var edges2=[
	[38,57],[37,35],[34,30],[32,54],[56,58],
	[59,47],[46,44],[43,41],[40,36],
	[33,26], [24,28], [39,29],
	[31,20], [25,23], [22,18],
	[55,53],
	[19,15],[51,17],
	[52,50],[45,49],
	[9,13],[12,1],[0,4],[3,7],[6,10],
	[11,42],[27,8],[5,21],[2,16],[14,48],
	[43,41],[41,29],[29,39],[52,50],[50,51],
	[49,45],[45,44],
	]
var edges3=[
	[56,32],[32,54],[54,53],[53,55],[55,58],[58,56],
	[58,47],[47,59],[59,38],[38,57],[57,56],
	[57,37],[37,35],[35,36],[36,40],[40,38],
	[37,34],[34,30],[30,33],[33,26],[26,35],
	[34,32],[54,31],[31,20],[20,30],
	[9,12],[12,1],[1,14],[14,48],[48,13],[13,9],
	[9,6],[6,10],[10,42],[42,11],[11,13],
	[6,3],[3,7],[7,27],[27,8],[8,10],
	[3,0],[0,4],[4,21],[21,5],[5,7],
	[0,12],[12,1],[1,16],[16,2],[2,4],
	[31,19],[19,15],[15,18],[18,22],[22,20],
	[19,17],[17,51],[51,16],[2,15],
	[17,53],[18,21],
	[22,25],[25,33],[36,39],[39,28],[28,26],
	[40,43],[43,46],[46,59],
	[47,49],[49,52],[52,55],
	[14,50],[50,51],
	[48,45],[45,44],[44,11],
	[42,41],[41,29],[29,8],
	[27,24],[24,23],[23,5],
	[51,17],[17,19],[19,15],
	[44,46],[46,43],[43,41],
	[22,25],[25,23],
	[29,39],[39,28],[28,24],
	[45,49],[52,50],
	]
var faces=[
	[0,3,6,9,12],
	[8,29,41,42,10],
	[5,23,24,27,7],
	[2,15,18,21,4],
	[1,14,50,51,16],
	[11,44,45,48,13],
	[32,56,57,37,34],
	[17,53,54,31,19],
	[47,58,55,52,49],
	[38,59,46,43,40],
	[26,35,36,39,28],
	[20,30,33,25,22],
]
function setupVertices(){
	var i,j,k,x,y,z,l;
	for (i=0;i<60;i++){
		v[i]=[];
		m[i]=[];
		f[i]=[];
		d[i]=[];
		}
		
	v[0]=[1,1,1];
	v[3]=[0,p,1/p];
	v[6]=[0,p,-1/p];
	v[9]=[1,1,-1];
	v[12]=[p,1/p,0];
	v[15]=[1/p,0,p];
	v[18]=[-1/p,0,p];
	v[21]=[-1,1,1];
	v[24]=[-p,1/p,0];
	v[27]=[-1,1,-1];
	v[30]=[-1,-1,1];
	v[33]=[-p,-1/p,0];
	v[36]=[-1,-1,-1];
	v[39]=[-1/p,0,-p];
	v[42]=[1/p,0,-p];
	v[45]=[1,-1,-1];
	v[48]=[p,-1/p,0];
	v[51]=[1,-1,1];
	v[54]=[0,-p,1/p];
	v[57]=[0,-p,-1/p];
	
	for (i=0;i<20;i++)
		for (j=1;j<3;j++)
			for (k=0;k<3;k++)
				v[3*i+j][k]=v[3*i][k];
	for (i=0;i<60;i++)
		for (j=0;j<3;j++)
			v[i][j]=R*v[i][j]/s3;
			
	for (i=0;i<edges.length;i++)
		for (j=0;j<3;j++)
			m[edges[i][0]][j]=(v[edges[i][0]][j]+v[edges[i][1]][j])/2;
	for (i=0;i<60;i++){
		l=sqrt(m[i][0]*m[i][0]+m[i][1]*m[i][1]+m[i][2]*m[i][2]);
		m[i][0]=R*m[i][0]/l;
		m[i][1]=R*m[i][1]/l;
		m[i][2]=R*m[i][2]/l;
	}
	for (i=0;i<faces.length;i++){
		x=0; y=0; z=0;
		for (j=0;j<5;j++){
			x+=v[faces[i][j]][0];
			y+=v[faces[i][j]][1];
			z+=v[faces[i][j]][2];
		}
		x=x/5; y=y/5; z=z/5;
		for (j=0;j<5;j++){
			f[faces[i][j]][0]=x;
			f[faces[i][j]][1]=y;
			f[faces[i][j]][2]=z;
		}
	}
	for (i=0;i<60;i++){
		l=sqrt(f[i][0]*f[i][0]+f[i][1]*f[i][1]+f[i][2]*f[i][2]);
		f[i][0]=R*f[i][0]/l;
		f[i][1]=R*f[i][1]/l;
		f[i][2]=R*f[i][2]/l;
	}	
	
}

function rotateCoords(){
	var x,y,z;
	var c=f[0][0];
	var s=f[0][1];
	var r=sqrt(c*c+s*s);
	c=c/r;
	s=s/r;
	
	for (i=0;i<60;i++){
		x=v[i][0];
		y=v[i][1];
		v[i][0]=c*x+s*y;
		v[i][1]=c*y-s*x;
		x=m[i][0];
		y=m[i][1];
		m[i][0]=c*x+s*y;
		m[i][1]=c*y-s*x;
		x=f[i][0];
		y=f[i][1];
		f[i][0]=c*x+s*y;
		f[i][1]=c*y-s*x;
	}
	
	s=f[0][0];
	c=f[0][2];
	var r=sqrt(c*c+s*s);
	c=c/r;
	s=s/r;
	
	for (i=0;i<60;i++){
		x=v[i][0];
		y=v[i][2];
		v[i][0]=c*x+s*y;
		v[i][2]=c*y-s*x;
		x=m[i][0];
		y=m[i][2];
		m[i][0]=c*x+s*y;
		m[i][2]=c*y-s*x;
		x=f[i][0];
		y=f[i][2];
		f[i][0]=c*x+s*y;
		f[i][2]=c*y-s*x;
	}
	
}
function drawSolid(t){
	if (t<=0.5)
		drawSolidM(2*t);
	else
		drawSolidMF(2*(t-0.5));
}
function drawSolidMF(t){
	var i,j;
	for (i=0;i<60;i++)
		for (j=0;j<3;j++)
			d[i][j]=(1-t)*m[i][j]+t*f[i][j];
//save();
//color('red');
	for (i=0;i<edges3.length;i++)
//	if (d[edges3[i][0]][2]>0)
		line(d[edges3[i][0]][0],d[edges3[i][0]][1],  d[edges3[i][1]][0],d[edges3[i][1]][1]);
//restore();
/*	for (i=0;i<60;i+=3)
//	if (d[i][2]>-100)
		{
//		triangle(
//			d[i][0],d[i][1],
//			d[i+1][0],d[i+1][1],
//			d[i+2][0],d[i+2][1]
//			);
			filltext(i,d[i][0],d[i][1]);
			filltext(i+1,d[i+1][0],d[i+1][1]);
			filltext(i+2,d[i+2][0],d[i+2][1]);
		}
*/		
}
function drawSolidF(t){
	var i,j;
	for (i=0;i<60;i++)
		for (j=0;j<3;j++)
			d[i][j]=(1-t)*v[i][j]+t*f[i][j];
	for (i=0;i<edges.length;i++)
		line(d[edges[i][0]][0],d[edges[i][0]][1],  d[edges[i][1]][0],d[edges[i][1]][1]);
	for (i=0;i<60;i+=3)
		triangle(
			d[i][0],d[i][1],
			d[i+1][0],d[i+1][1],
			d[i+2][0],d[i+2][1]
			);
}
function drawSolidM(t){
	var i,j;
	for (i=0;i<60;i++)
		for (j=0;j<3;j++)
			d[i][j]=(1-t)*v[i][j]+t*m[i][j];
//save();
//color('red');
	for (i=0;i<edges2.length;i++)
//	if (d[edges2[i][0]][2]>0)
		line(d[edges2[i][0]][0],d[edges2[i][0]][1],  d[edges2[i][1]][0],d[edges2[i][1]][1]);
//restore();
	for (i=0;i<60;i+=3)
//	if (d[i][2]>-100)
	{
		triangle(
			d[i][0],d[i][1],
			d[i+1][0],d[i+1][1],
			d[i+2][0],d[i+2][1]
			);
//			filltext(i,d[i][0],d[i][1]);
//			filltext(i+1,d[i+1][0],d[i+1][1]);
//			filltext(i+2,d[i+2][0],d[i+2][1]);
			}
}
function drawpoint(n){
	point(v[n][0],v[n][1]);
}
function setup(){
	p=(1+sqrt(5))/2;
	s3=sqrt(3);
	size(2*R+50,2*R+50);
	translate(width/2, height/2);
	font('20px times');
	setupVertices();
	rotateCoords();
	loop();
}
var T=0;
var multiplier=1;
function draw(){
	clear();
	drawSolid(T);
	T=(T+multiplier*0.0005);
	if (T>1) {multiplier=-1*multiplier; T=1;}
	else if (T<0) {multiplier=-1*multiplier;T=0;}
}
function onclick(){startloop();}
</script>
</head>
<body>
<div id='spork'></div>

</body>
</html>