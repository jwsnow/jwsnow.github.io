<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
<style>
#spork{
	position: absolute;
	left: 0px;
	right: 0px;
	top: 0px;
	bottom:0px;
}
</style>
<script src="spork.js"></script>
<script>
var TX=[];
var TY=[];
var X=[];
var Y=[];
var FX=[];
var FY=[];
var N=39;
var N2=N*N;
var S=10;
var R=50*50;
var k=400;
var l=0.1;

function accumulateForces(){
  var dx, dy, d2;
    for (i=0;i<N2;i++){
        FX[i]=0;
        FY[i]=0;
      }
  if (mouseDown)
    for (i=0;i<N2;i++){
        dx=mouseX-X[i];
        dy=mouseY-Y[i];
        d2=dx*dx+dy*dy;
        if (d2!=0 && d2<R){
          FX[i]=-k*dx/(d2);
          FY[i]=-k*dy/(d2);
        }
        else{
          FX[i]=0;
          FX[i]=0;
        }
      }
  for (i=0;i<N2;i++){
      dx=TX[i]-X[i];
      dy=TY[i]-Y[i];
      FX[i]+=l*dx;
      FY[i]+=l*dy;
    }
}

function updatePositions(){
  var i,j;
  for (i=0;i<N2;i++){
      X[i]=X[i]+FX[i];
      Y[i]=Y[i]+FY[i];
    }
}
function displayPoints(){
  var i,j;
  for (i=0;i<N2;i++)
    rect(X[i],Y[i], 1, 1);
//      point(X[i], Y[i]);
  
}
function flattenPoints(){
  for (i=0;i<N2;i++){
      if (X[i]<0)
        X[i]=0;
      else if (X[i]>width)
        X[i]=width;
      if (Y[i]<0)
        Y[i]=0;
      else if (Y[i]>height)
        Y[i]=height;
    }
}
function updatePoints(){
  accumulateForces();
  updatePositions();
  flattenPoints();
  displayPoints();
}
function setup(){
  //size(400,400);
  fillContainer();
  N=floor(width/S-1);
  var M =floor(height/S-1);
  N2=N*M;
  var i,j;
  for (i=0;i<N;i++)
    for (j=0;j<M;j++){
      TX[i+j*N]=i*S+S;
      TY[i+j*N]=j*S+S;
      X[i+j*N]=i*S+S;
      Y[i+j*N]=j*S+S;
      FX[i+j*N]=0;
      FY[i+j*N]=0;
    }
    loop();
}
function draw(){
  clear();
  updatePoints();
}
</script>
</head>
<body>
<div id='spork'></div>
<div id='output'></div>
</body>
</html>
